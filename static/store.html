<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tìm Cửa Hàng Gần Nhất</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="./assets/css/map.css">

    <!-- Reset CSS -->
    <link rel="stylesheet" href="./assets/css/reset.css" />

    <!-- Thêm favicon -->
    <link
        rel="icon"
        type="image/x-icon"
        href="./assets/icons/logo2_no_text.svg"
    />

    <!-- Nhúng phông chữ -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet"
    />

    <!-- Font Awesome-->
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous"
        referrerpolicy="no-referrer"
    />
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/js/all.min.js"
        integrity="sha512-6sSYJqDreZRZGkJ3b+YfdhB3MzmuP9R7X1QZ6g5aIXhRvR1Y/N/P47jmnkENm7YL3oqsmI6AK+V6AD99uWDnIw=="
        crossorigin="anonymous"
        referrerpolicy="no-referrer"
    ></script>

    <!-- Kiểu CSS -->
    <link rel="stylesheet" href="./assets/css/style.css" />
    <link rel="stylesheet" href="./assets/css/banner.css" />
    <link rel="stylesheet" href="./assets/css/danhmucgachmen.css" />
    <link rel="stylesheet" href="./assets/css/popular.css" />
    <link rel="stylesheet" href="./assets/css/cacthanhphancodinh.css" />
    
</head>
<body>

   <!-- Đầu trang -->
   <header class="header fixed">
    <div class="main-content">
        <div class="body">
            <!-- Logo -->
            <a href="./index.html">
                <img
                    src="./assets/icons/logo2.svg"
                    alt="Logo"
                    class="logo"
                />
            </a>

            <!-- Thanh tìm kiếm -->
            <div class="search-bar">
                <input type="text" placeholder="Tìm kiếm sản phẩm..." />
                <i class="fa-solid fa-magnifying-glass search-icon"></i>
            </div>

            <!-- Hành động -->
            <div class="action">
                <a href="login.html" class="btn sign-up-btn"
                    >Đăng Nhập</a
                >
            </div>

            <!-- Cart Button -->
            <a href="./giohang.html" class="cart-button">
                <svg
                    class="icon"
                    width="30"
                    height="30"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                >
                    <path
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M10 20C10 21.6569 8.65685 23 7 23C5.34315 23 4 21.6569 4 20C4 18.3431 5.34315 17 7 17C8.65685 17 10 18.3431 10 20ZM8 20C8 20.5523 7.55228 21 7 21C6.44772 21 6 20.5523 6 20C6 19.4477 6.44772 19 7 19C7.55228 19 8 19.4477 8 20Z"
                        fill="#2e2100ff"
                    />
                    <path
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M20 20C20 21.6569 18.6569 23 17 23C15.3431 23 14 21.6569 14 20C14 18.3431 15.3431 17 17 17C18.6569 17 20 18.3431 20 20ZM18 20C18 20.5523 17.5523 21 17 21C16.4477 21 16 20.5523 16 20C16 19.4477 16.4477 19 17 19C17.5523 19 18 19.4477 18 20Z"
                        fill="#2e2100ff"
                    />
                    <path
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M2.10557 2.55276C2.35256 2.05878 2.95323 1.85856 3.44721 2.10555L4.45072 2.6073C5.37999 3.07193 6.0027 3.98429 6.09676 5.01898L6.1446 5.54524C6.16801 5.80278 6.38394 5.99997 6.64255 5.99997H19.8355C21.581 5.99997 22.7892 7.74341 22.1763 9.37778L20.423 14.0533C19.9839 15.2243 18.8645 16 17.614 16H7.82643C6.27482 16 4.97922 14.8168 4.83875 13.2716L4.10497 5.20005C4.07362 4.85515 3.86605 4.55103 3.55629 4.39616L2.55278 3.8944C2.05881 3.64741 1.85858 3.04674 2.10557 2.55276ZM6.91527 7.99997C6.62126 7.99997 6.39071 8.25243 6.41733 8.54524L6.83053 13.0905C6.87736 13.6056 7.30922 14 7.82643 14H17.614C18.0308 14 18.404 13.7414 18.5503 13.3511L20.3037 8.67554C20.4262 8.34866 20.1846 7.99997 19.8355 7.99997H6.91527Z"
                        fill="#2e2100ff"
                    />
                </svg>
            </a>
        </div>
    </div>
</header>


<div class="ct-map">
    <div class="title-dexuat">Đề Xuất Các Cửa Hàng Gần Nhất</div>
    <input type="text" id="searchInput" placeholder="Nhập vị trí để tìm kiếm cửa hàng gần nhất" />
    <button id="searchButton">Tìm kiếm</button>
<div class="map-main">
    <div id="map"></div>
    <div id="store-info">
        <div id="store-name" class="info-title">Tên cửa hàng</div>
        <div id="store-phone" class="info-item">Số điện thoại: </div>
        <div id="store-hours" class="info-item">Thời gian làm việc: </div>
        <div id="store-distance" class="info-item">Khoảng cách: </div>
        <div id="store-address" class="info-item">Địa chỉ: </div>
        <img id="store-image" src="" alt="" class="popup-img" />
    </div>
</div>
    
</div>

  <!-- Footer -->
  <div class="footer">
    <div class="main-content">
        <div class="footer__row">
            <!-- Footer column 1 -->
            <div class="footer__col">
                <!-- Logo -->
                <a href="#" class="logo footer__logo">
                    <img
                        src="./assets/icons/logo2_2.svg"
                        alt="grocerymart"
                        class="logo__img"
                    />
                </a>
                <p class="footer__desc">
                    "Kiến tạo không gian đẳng cấp – Gạch men bền đẹp,
                    chất lượng vượt thời gian."
                </p>

                <p class="footer__help-text">
                    Gửi mail của bạn để nhận các thông tin mới nhất về
                    sản phẩm.
                </p>
                <form action="" class="footer__form">
                    <input
                        type="text"
                        class="footer__input"
                        placeholder="Nhập email của bạn..."
                    />
                    <button class="btn btn--primary">Gửi</button>
                </form>
            </div>

            <!-- Footer column 2 -->
            <div class="footer__col">
                <h3 class="footer__heading">Về chúng tôi</h3>
                <ul class="footer__list">
                    <li>
                        <a href="#!" class="footer__link">Giới thiệu</a>
                    </li>
                    <li>
                        <a href="#!" class="footer__link"
                            >Đánh giá khách hàng</a
                        >
                    </li>
                    <li>
                        <a href="#!" class="footer__link">Tuyển dụng</a>
                    </li>
                    <li>
                        <a href="#!" class="footer__link"
                            >Giấy phép kinh doanh</a
                        >
                    </li>
                    <li>
                        <a href="#!" class="footer__link"
                            >Các bộ phận</a
                        >
                    </li>
                </ul>
            </div>

            <!-- Footer column 3 -->
            <div class="footer__col">
                <h3 class="footer__heading">Hỗ trợ</h3>
                <ul class="footer__list">
                    <li>
                        <a href="#!" class="footer__link"
                            >Trạng thái đơn hàng</a
                        >
                    </li>
                    <li>
                        <a href="#!" class="footer__link">Bảo hành</a>
                    </li>
                </ul>
            </div>

            <!-- Footer column 4 -->
            <div class="footer__col">
                <h3 class="footer__heading">Chính Sách</h3>
                <ul class="footer__list">
                    <li>
                        <a href="#!" class="footer__link"
                            >Dịch vụ khách hàng</a
                        >
                    </li>
                    <li>
                        <a href="#!" class="footer__link"
                            >Hướng dẫn mua hàng</a
                        >
                    </li>
                    <li>
                        <a href="#!" class="footer__link"
                            >Hướng dẫn thanh toán</a
                        >
                    </li>
                    <li>
                        <a href="#!" class="footer__link"
                            >Giao hàng và nhận hàng</a
                        >
                    </li>
                    <li>
                        <a href="#!" class="footer__link"
                            >Chính sách đổi trả</a
                        >
                    </li>
                    <li>
                        <a href="#!" class="footer__link"
                            >Chính sách bảo mật</a
                        >
                    </li>
                </ul>
            </div>

            <!-- Footer column 5 -->
            <div class="footer__col">
                <h3 class="footer__heading">Liên hệ</h3>
                <ul class="footer__list">
                    <li>
                        <p class="footer__label">Email</p>
                        <a
                            href="cuahanggachmen@gmail.com"
                            class="footer__link footer__text"
                        >
                            cuahanggachmen@gmail.com
                        </a>
                    </li>
                    <li>
                        <p class="footer__label">Số điện thoại</p>
                        <a
                            href="tel:18008888"
                            class="footer__link footer__text"
                            >0376272024</a
                        >
                    </li>
                    <li>
                        <p class="footer__label">Địa chỉ</p>
                        <p class="footer__text">
                            Khu phố 6, Phường Linh Trung, Thành Phố Thủ
                            Đức, Hồ Chí Minh
                        </p>
                    </li>
                    <li>
                        <p class="footer__label">Thời gian làm việc</p>
                        <p class="footer__text">
                            08:00 - 18:00 T2-T7 Hàng Tuần
                        </p>
                    </li>
                </ul>
            </div>
        </div>
        <div class="footer__bottom">
            <p class="footer__copyright">
                © 2024 - 2025 Cửa hàng gạch men.
            </p>

            <div class="footer__socials">
                <a
                    href="#!"
                    class="footer__social-link footer__social-link--facebook"
                >
                    <img
                        src="./assets/icons/facebook.svg"
                        alt=""
                        class="footer__social-icon"
                    />
                </a>
                <a
                    href="#!"
                    class="footer__social-link footer__social-link--youtube"
                >
                    <img
                        src="./assets/icons/youtube.svg"
                        alt=""
                        class="footer__social-icon"
                    />
                </a>
                <a
                    href="#!"
                    class="footer__social-link footer__social-link--tiktok"
                >
                    <img
                        src="./assets/icons/tiktok.svg"
                        alt=""
                        class="footer__social-icon"
                    />
                </a>
                <a
                    href="#!"
                    class="footer__social-link footer__social-link--twitter"
                >
                    <img
                        src="./assets/icons/twitter.svg"
                        alt=""
                        class="footer__social-icon"
                    />
                </a>
                <a
                    href="#!"
                    class="footer__social-link footer__social-link--linkedin"
                >
                    <img
                        src="./assets/icons/linkedin.svg"
                        alt=""
                        class="footer__social-icon"
                    />
                </a>
            </div>
        </div>
    </div>
</div>
    

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-geocoder/2.0.0/Control.Geocoder.js"></script>
    <script>
        // 1. Khởi tạo bản đồ
        var map = L.map('map').setView([10.817, 106.713], 12); // Vị trí trung tâm Thành Phố Thủ Đức

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // 2. Tạo các cửa hàng ngẫu nhiên với thông tin chi tiết
        var stores = [];
        for (let i = 0; i < 50; i++) {
            let lat = 10.817 + (Math.random() - 0.5) * 0.1; // Tạo tọa độ ngẫu nhiên gần TP Thủ Đức
            let lng = 106.713 + (Math.random() - 0.5) * 0.1;
            stores.push({
                lat: lat, 
                lng: lng, 
                name: 'Cửa hàng ' + (i + 1),
                hours: '08:00 - 17:00',
                phone: '090xxxxxxx',
                image: `https://s7d1.scene7.com/is/image/TileShop/STORE105?$500x500JPG$`  // URL hình ảnh ngẫu nhiên
            });
        }

        // 3. Tạo các marker cho cửa hàng
        var storeMarkers = [];
        stores.forEach(function(store, index) {
            var marker = L.marker([store.lat, store.lng]).addTo(map);

            // Popup hiển thị thông tin chi tiết
            var popupContent = `
                <b>${store.name}</b><br>
               
            `;
            marker.bindPopup(popupContent);

            // Khi nhấn vào cửa hàng, hiển thị thông tin vào bảng bên phải
            marker.on('click', function() {
                // Cập nhật thông tin cửa hàng trong bảng bên phải
                document.getElementById('store-name').innerText = store.name;
                document.getElementById('store-phone').innerText = 'Số điện thoại: ' + store.phone;
                document.getElementById('store-hours').innerText = 'Thời gian làm việc: ' + store.hours;
                
                // Sử dụng geocoding để lấy địa chỉ từ tọa độ cửa hàng
                var geocodeUrl = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${store.lat}&lon=${store.lng}&addressdetails=1`;
                fetch(geocodeUrl)
                    .then(response => response.json())
                    .then(data => {
                        var address = data.display_name;
                        document.getElementById('store-address').innerText = 'Địa chỉ: ' + address;
                    })
                    .catch(error => {
                        console.error("Lỗi geocoding: ", error);
                        document.getElementById('store-address').innerText = 'Địa chỉ: Không thể tìm thấy địa chỉ';
                    });

                document.getElementById('store-image').src = store.image;
                
                // Tính khoảng cách từ vị trí hiện tại của người dùng đến cửa hàng
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function(position) {
                        var userLat = position.coords.latitude;
                        var userLng = position.coords.longitude;
                        var distance = haversine(userLat, userLng, store.lat, store.lng);
                        document.getElementById('store-distance').innerText = 'Khoảng cách: ' + distance.toFixed(2) + ' km';
                    });
                }
            });

            storeMarkers.push(marker);
        });

        // 4. Tính khoảng cách Haversine
        function haversine(lat1, lon1, lat2, lon2) {
            var R = 6371; // Radius of the Earth in km
            var dLat = (lat2 - lat1) * Math.PI / 180;
            var dLon = (lon2 - lon1) * Math.PI / 180;
            var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                    Math.sin(dLon / 2) * Math.sin(dLon / 2);
            var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            var distance = R * c; // in km
            return distance;
        }

        // 5. Tạo hộp giới hạn cho Thành Phố Thủ Đức (bounding box)
        var bounds = [
            [10.7500, 106.7000], // Điểm cực tây của Thủ Đức
            [10.9000, 106.8000]  // Điểm cực đông của Thủ Đức
        ];

        // 6. Tìm cửa hàng gần nhất và tính khoảng cách
        document.getElementById('searchButton').addEventListener('click', function() {
            var address = document.getElementById('searchInput').value;
            if (address === "") return alert("Vui lòng nhập địa chỉ!");

            // Geocode địa chỉ (Sử dụng Nominatim API từ OSM)
            var geocodeUrl = `https://nominatim.openstreetmap.org/search?format=json&q=${address}&addressdetails=1`;
            fetch(geocodeUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.length === 0) {
                        alert("Không tìm thấy địa chỉ!");
                        return;
                    }

                    // Lấy tọa độ của địa chỉ
                    var lat = parseFloat(data[0].lat);
                    var lng = parseFloat(data[0].lon);

                    // Kiểm tra xem địa chỉ có nằm trong Thủ Đức không
                    if (lat < bounds[0][0] || lat > bounds[1][0] || lng < bounds[0][1] || lng > bounds[1][1]) {
                        alert("Địa chỉ không nằm trong Thành Phố Thủ Đức.");
                        return;
                    }

                    // Hiển thị vị trí người dùng trên bản đồ
                    L.marker([lat, lng]).addTo(map).bindPopup("Vị trí của bạn").openPopup();
                    map.setView([lat, lng], 14);
                })
                .catch(error => {
                    console.error("Lỗi geocode: ", error);
                    alert("Đã xảy ra lỗi khi tìm địa chỉ.");
                });
        });
    </script>
</body>
</html>
